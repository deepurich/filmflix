<html>
<header>
    <title>Test page</title>
    <link rel="stylesheet" href="styles.css">
</header>

<body style="background-color:rgb(29, 154, 142);">
    <div>This is simple test to get data from a backend</div>
    <div><span>Last update: </span><span id="time-container"></span></div>
    <button onclick="getFilms()">Get films </button>
    <button onclick="Addfilms()">Add films</button>

    <div id="result-container"></div>
    <div class="loginPopup"></div>
    <div class="formPopup" id="loginAddfilms">

        <label for="filmID">filmID:</label><br>
        <input type="text" id="filmID" name="filmID"><br>
        <label for="title">title:</label><br>
        <input type="text" id="title" name="title"><br>
        <label for="yearReleased">yearReleased:</label><br>
        <input type="text" id="yearReleased" name="yearReleased"><br>
        <label for="rating"></label>rating:</label><br>
        <input type="text" id="rating" name="rating"><br>
        <label for="duration"></label>duration:</label><br>
        <input type="text" id="duration" name="duration"><br>
        <label for="genre"></label>genre:</label><br>
        <input type="text" id="genre" name="genre"><br><br>
        <button onclick="postFilms()">Add film</button>
        <button onclick="putFilms()">Update film</button>
        <button onclick="deleteFilms()">delete film</button>
        <button type="button" class="btn cancel" onclick="closeFilms()">Close</button>

    </div>
    </div>
</body>
<script>
    var xhr = null;

    getXmlHttpRequestObject = function () {
        if (!xhr) {
            // Create a new XMLHttpRequest object 
            xhr = new XMLHttpRequest();
        }
        return xhr;
    };

    function dataCallback() {
        // Check response is ready or not
        if (xhr.readyState == 4 && xhr.status == 200) {
            console.log("User data received!");
            getDate();
            dataDiv = document.getElementById('result-container');
            // Set current data text
            dataDiv.innerHTML = render(xhr.responseText);
        }
    }

    function render(films) {
        myObj = JSON.parse(films);
        text = "<table border='1'>";
        text += "<tr><th>Film ID</th><th>Title</th><th>Genre</th><th>Year Released</th><th>Duration</th><th>Rating</th></tr>"
        for (x in myObj) {
            text += "<tr>"
                + "<td>" + myObj[x].filmID + "</td>"
                + "<td>" + myObj[x].title + "</td>"
                + "<td>" + myObj[x].genre + "</td>"
                + "<td>" + myObj[x].yearReleased + "</td>"
                + "<td>" + myObj[x].duration + "</td>"
                + "<td>" + myObj[x].rating + "</td>"
                + "</tr>"
        }
        text += "</table>";
        return text;
    }

    function getUsers() {
        console.log("Get users...");
        xhr = getXmlHttpRequestObject();
        xhr.onreadystatechange = dataCallback;
        // asynchronous requests
        xhr.open("GET", "https://filmflix--ratnabollapalli.repl.co/users", true);
        // Send the request over the network
        xhr.send(null);
    }
    function getFilms() {
        console.log("Get films...");
        xhr = getXmlHttpRequestObject();
        xhr.onreadystatechange = dataCallback;
        // asynchronous requests
        xhr.open("GET", "https://filmflix--ratnabollapalli.repl.co/films", true);
        // Send the request over the network
        xhr.send(null);
    }

    function getDate() {
        date = new Date().toString();

        document.getElementById('time-container').textContent
            = date;
    }

    function postFilms() {
        filmID = document.getElementById('filmID').value;
        title = document.getElementById('title').value;
        yearReleased = document.getElementById('yearReleased').value;
        rating = document.getElementById('rating').value;
        duration = document.getElementById('duration').value;
        genre = document.getElementById('genre').value;
        dataToSend = {
            "duration": duration,
            "filmID": filmID,
            "genre": genre,
            "rating": rating,
            "title": title,
            "yearReleased": yearReleased
        }
        console.log("post films...");
        xhr = getXmlHttpRequestObject();
        xhr.onreadystatechange = dataCallback;
        // asynchronous requests
        xhr.open("POST", "https://filmflix--ratnabollapalli.repl.co/films", true);
        // Send the request over the network
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.send(JSON.stringify(dataToSend));

    }
    function putFilms() {
        filmID = document.getElementById('filmID').value;
        title = document.getElementById('title').value;
        yearReleased = document.getElementById('yearReleased').value;
        rating = document.getElementById('rating').value;
        duration = document.getElementById('duration').value;
        genre = document.getElementById('genre').value;
        dataToSend = {
            "duration": duration,
            "filmID": filmID,
            "genre": genre,
            "rating": rating,
            "title": title,
            "yearReleased": yearReleased
        }
        console.log("post films...");
        xhr = getXmlHttpRequestObject();
        xhr.onreadystatechange = dataCallback;
        // asynchronous requests
        xhr.open("PUT", "https://filmflix--ratnabollapalli.repl.co/films", true);
        // Send the request over the network
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.send(JSON.stringify(dataToSend));

    }
    function deleteFilms() {
        filmID = document.getElementById('filmID').value;
        dataToSend = {
            "filmID": filmID
        }
        console.log("delete films...");
        xhr = getXmlHttpRequestObject();
        xhr.onreadystatechange = dataCallback;
        // asynchronous requests
        xhr.open("DELETE", "https://filmflix--ratnabollapalli.repl.co/films", true);
        // Send the request over the network
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.send(JSON.stringify(dataToSend));
    }
    function Addfilms() {
        document.getElementById("loginAddfilms").style.display = "block";
    }
    function closeFilms() {
        document.getElementById("loginAddfilms").style.display = "none";
    }
    window.onclick = function (event) {
        let modal = document.getElementById('loginAddfilms');
        if (event.target == modal) {
            closeForm();
        }
    }
</script>

</html>